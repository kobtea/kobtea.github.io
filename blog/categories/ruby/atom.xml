<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | blog.kobtea.net]]></title>
  <link href="http://blog.kobtea.net/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://blog.kobtea.net/"/>
  <updated>2014-11-24T23:29:01+09:00</updated>
  <id>http://blog.kobtea.net/</id>
  <author>
    <name><![CDATA[kobtea]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[MBAにRuby環境を作る]]></title>
    <link href="http://blog.kobtea.net/blog/2013/09/23/install-ruby-on-mba/"/>
    <updated>2013-09-23T00:17:00+09:00</updated>
    <id>http://blog.kobtea.net/blog/2013/09/23/install-ruby-on-mba</id>
    <content type="html"><![CDATA[<pre><code class="bash">$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.8.4
BuildVersion:   12E3067
</code></pre>

<p><a href="https://github.com/sstephenson/rbenv">rbenv</a>のreadmeにそってやる。<br/>
PATHについて解説までしてくれるとかマジ天使。</p>

<h2>rbenvのインストール</h2>

<pre><code class="bash"># homebrewを最新の状態に
$ brew update
$ brew upgrade

# rbenvをインストール
$ brew install rbenv
==&gt; Downloading https://github.com/sstephenson/rbenv/archive/v0.4.0.tar.gz
######################################################################## 100.0%
==&gt; Caveats
To use Homebrew's directories rather than ~/.rbenv add to your profile:
  export RBENV_ROOT=/usr/local/var/rbenv

To enable shims and autocompletion add to your profile:
  if which rbenv &gt; /dev/null; then eval "$(rbenv init -)"; fi
==&gt; Summary
🍺  /usr/local/Cellar/rbenv/0.4.0: 31 files, 152K, built in 2 seconds

# ruby-buildをインストール
$ brew install ruby-build
######################################################################## 100.0%
==&gt; ./configure --prefix=/usr/local/Cellar/autoconf/2.69
==&gt; make install
🍺  /usr/local/Cellar/autoconf/2.69: 69 files, 2.0M, built in 8 seconds
==&gt; Installing ruby-build
==&gt; Downloading https://github.com/sstephenson/ruby-build/archive/v20130907.tar.gz
######################################################################## 100.0%
==&gt; ./install.sh
🍺  /usr/local/Cellar/ruby-build/20130907: 83 files, 368K, built in 2 seconds
</code></pre>

<p>profileとかrcに以下を追記する。</p>

<pre><code class="bash">$ echo 'if which rbenv &gt; /dev/null; then eval "$(rbenv init -)"; fi' &gt;&gt; ~/.zprofile
$ source ~/.zprofile
</code></pre>

<pre><code class="bash">$ rbenv --help
rbenv 0.4.0
Usage: rbenv &lt;command&gt; [&lt;args&gt;]

Some useful rbenv commands are:
   commands    List all available rbenv commands
   local       Set or show the local application-specific Ruby version
   global      Set or show the global Ruby version
   shell       Set or show the shell-specific Ruby version
   install     Install a Ruby version using the ruby-build plugin
   uninstall   Uninstall a specific Ruby version
   rehash      Rehash rbenv shims (run this after installing executables)
   version     Show the current Ruby version and its origin
   versions    List all Ruby versions available to rbenv
   which       Display the full path to an executable
   whence      List all Ruby versions that contain the given executable

See `rbenv help &lt;command&gt;' for information on a specific command.
For full documentation, see: https://github.com/sstephenson/rbenv#readme
</code></pre>

<h2>rbenv-default-gemsをインストール</h2>

<p>ついでに<a href="https://github.com/sstephenson/rbenv-default-gems">rbenv-default-gems</a>を入れておく。<br/>
<code>rbenv install &lt;version&gt;</code>でRubyをインストールする際に、一緒に必要なgemを入れてくれる。</p>

<pre><code class="bash">$ echo 'bundler' &gt;&gt; ~/.rbenv/default-gems
</code></pre>

<p>ひとまずbundlerだけでいいかな。</p>

<pre><code class="bash"># 一応homebrewを再度更新
$ brew update
$ brew upgrade

# ruby 2.0をインストール
$ rbenv install 2.0.0-p247
Downloading openssl-1.0.1e.tar.gz...
-&gt; https://www.openssl.org/source/openssl-1.0.1e.tar.gz
Installing openssl-1.0.1e...

BUILD FAILED

Inspect or clean up the working tree at /var/folders/fz/6spm20xn2n34zk3rhc5q1b6c0000gn/T/ruby-build.20130922145805.39114
Results logged to /var/folders/fz/6spm20xn2n34zk3rhc5q1b6c0000gn/T/ruby-build.20130922145805.39114.log

Last 10 log lines:
RANLIB        =true
ARFLAGS       =
PERL          =/usr/bin/perl
SIXTY_FOUR_BIT_LONG mode
DES_UNROLL used
DES_INT used
RC4 uses uchar
RC4_CHUNK is unsigned long
sh: make: command not found
/usr/local/bin/ruby-build: line 387: make: command not found
</code></pre>

<p>makeコマンドがないぽい。<br/>
command line toolsが入ってなかった。</p>

<pre><code>Xcode -&gt; Preferences -&gt; Downloads -&gt; Command Line Tools -&gt; Install
</code></pre>

<p>リトライ。</p>

<pre><code class="bash">$ rbenv install 2.0.0-p247
Downloading openssl-1.0.1e.tar.gz...
-&gt; https://www.openssl.org/source/openssl-1.0.1e.tar.gz
Installing openssl-1.0.1e...
Installed openssl-1.0.1e to /Users/kobtea/.rbenv/versions/2.0.0-p247

Downloading ruby-2.0.0-p247.tar.gz...
-&gt; http://cache.ruby-lang.org/pub/ruby/2.0/ruby-2.0.0-p247.tar.gz
Installing ruby-2.0.0-p247...
Installed ruby-2.0.0-p247 to /Users/kobtea/.rbenv/versions/2.0.0-p247

ERROR:  While executing gem ... (Gem::FilePermissionError)
    You don't have write permissions into the /Library/Ruby/Gems/1.8 directory.
rbenv: error installing gem `bundler'
</code></pre>

<p>今度は権限がない。<br/>
<a href="https://github.com/sstephenson/rbenv-default-gems/issues/7">Issue</a>に載っていた。<br/>
どうやら環境変数に<code>$RBENV_ROOT</code>が必要らしい。</p>

<pre><code class="bash">$ rbenv root
</code></pre>

<p>で表示されたパスを.zprofileとかに書く。</p>

<pre><code class="bash">$ echo 'export RBENV_ROOT=$HOME/.rbenv' &gt;&gt; ~/.zprofile
$ source ~/.zprofile
</code></pre>

<p>リトライ。</p>

<pre><code class="bash">$ rbenv install 2.0.0-p247
rbenv: /Users/kobtea/.rbenv/versions/2.0.0-p247 already exists
continue with installation? (y/N) y
Downloading openssl-1.0.1e.tar.gz...
-&gt; https://www.openssl.org/source/openssl-1.0.1e.tar.gz
Installing openssl-1.0.1e...
Installed openssl-1.0.1e to /Users/kobtea/.rbenv/versions/2.0.0-p247

Downloading ruby-2.0.0-p247.tar.gz...
-&gt; http://cache.ruby-lang.org/pub/ruby/2.0/ruby-2.0.0-p247.tar.gz
Installing ruby-2.0.0-p247...
Installed ruby-2.0.0-p247 to /Users/kobtea/.rbenv/versions/2.0.0-p247

Fetching: bundler-1.3.5.gem (100%)
Successfully installed bundler-1.3.5
Parsing documentation for bundler-1.3.5
Installing ri documentation for bundler-1.3.5
1 gem installed
</code></pre>

<p>できた。</p>

<pre><code class="bash"># ruby, gemのパスが$RBENV_ROOT以下に向いているか確認
$ rbenv rehash
$ rbenv versions
* system (set by /Users/kobtea/.rbenv/version)
  2.0.0-p247
$ which ruby
/Users/kobtea/.rbenv/shims/ruby
$ which gem
/Users/kobtea/.rbenv/shims/gem

# システムデフォルトのバージョン確認
$ ruby --version
ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin12.0]
$ gem --version
1.3.6

# デフォルトのバージョンを2.0に変更
$ rbenv global 2.0.0-p247
$ rbenv versions
  system
* 2.0.0-p247 (set by /Users/kobtea/.rbenv/version)

$ ruby --version
ruby 2.0.0p247 (2013-06-27 revision 41674) [x86_64-darwin12.4.1]
$ gem --version
2.0.3
</code></pre>

<p>こんにちはRuby。</p>

<h2>追記</h2>

<p>Macデフォルトのreadlineは使わないほうがいいらしい。<br/>
<code>rbenv install</code>する際にはhomebrewで入れたreadline, opensslを指定する。<br/>
指定しない場合、Macだとirbでマルチバイトが使えない。<br/>
<a href="/blog/2013/09/22/use-multibytes-on-ruby">irbで日本語が文字化けする</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Irbで日本語が文字化けする]]></title>
    <link href="http://blog.kobtea.net/blog/2013/09/22/use-multibytes-on-ruby/"/>
    <updated>2013-09-22T23:38:00+09:00</updated>
    <id>http://blog.kobtea.net/blog/2013/09/22/use-multibytes-on-ruby</id>
    <content type="html"><![CDATA[<pre><code class="bash">$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.8.4
BuildVersion:   12E3067

$ ruby --version
ruby 2.0.0p247 (2013-06-27 revision 41674) [x86_64-darwin12.4.1]

$ irb --version
irb 0.9.6(09/06/30)
</code></pre>

<p>&lsquo;日本語&#8217;と打とうとするとこうなる。</p>

<pre><code class="ruby">$ irb
irb(main):001:0&gt; p '\U+FFE6\U+FFA5\U+FFE6\U+FFAC\U+FFE8\U+FFAA'
""
=&gt; ""
</code></pre>

<p>色々調べてみたらMacデフォルトのreadlineがあんまりイケてないとのこと。</p>

<blockquote><p>irb で日本語を使うならば、下記でインストール。<br/>
<code>bash
CONFIGURE_OPTS="--with-readline-dir=`brew --prefix readline` --enable-bundled-libyaml" rbenv install 2.0.0-p247
</code></p>

<p><a href="http://www.d-wood.com/blog/2013/08/06_4453.html">[Ruby on Rails] RUBY_CONFIGURE_OPTS, readline, openssl</a></p></blockquote>

<pre><code class="bash"># readlineとopensslをインストールする
$ brew install readline
$ brew install openssl

# 参考通りにやってみる
$ CONFIGURE_OPTS="--with-readline-dir=`brew --prefix readline` --enable-bundled-libyaml" rbenv install 2.0.0-p247
rbenv: /Users/kobtea/.rbenv/versions/2.0.0-p247 already exists
continue with installation? (y/N) y
Downloading ruby-2.0.0-p247.tar.gz...
-&gt; http://cache.ruby-lang.org/pub/ruby/2.0/ruby-2.0.0-p247.tar.gz
Installing ruby-2.0.0-p247...
Installed ruby-2.0.0-p247 to /Users/kobtea/.rbenv/versions/2.0.0-p247

Fetching: bundler-1.3.5.gem (100%)
Successfully installed bundler-1.3.5
Parsing documentation for bundler-1.3.5
Installing ri documentation for bundler-1.3.5
1 gem installed
</code></pre>

<p>どきどき&hellip;</p>

<pre><code class="ruby">$ irb
irb(main):001:0&gt; puts 'ほげ'
ほげ
=&gt; nil
irb(main):002:0&gt; p 'ほげ'
"ほげ"
=&gt; "ほげ"
</code></pre>

<p>やったあ！！！！！！！！！！！<br/>
本当にありがとうございます。</p>
]]></content>
  </entry>
  
</feed>
