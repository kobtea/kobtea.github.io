<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>YAPC::Asia Tokyo 2015 「ISUCONの勝ち方」メモ - kobtea.net</title>
    <meta name="description" content="eternal jojaku">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <link rel="stylesheet" href="http://kobtea.net/css/capybara.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>

<body>
<header>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#header-navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://kobtea.net">kobtea.net</a>

                <p class="navbar-text">eternal jojaku</p>
            </div>

            <div class="collapse navbar-collapse" id="header-navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li><a href="/posts/">archives</a></li>
                    
                    <li><a href="/posts/index.xml">rss</a></li>
                    
                </ul>
            </div>
        </div>
    </nav>
</header>


<article class="container-fluid">
    <div class="page-header">
        <h1><a href="http://kobtea.net/posts/2015/08/22/yapc-isucon/">YAPC::Asia Tokyo 2015 「ISUCONの勝ち方」メモ</a></h1>
        <time pubdate datetime=" 2015-08-22 " title="2015-08-22">2015-08-22</time>
        
        <a href="/tags/conference">
            <button type="button" class="btn btn-default btn-xs">conference</button>
        </a>
        
    </div>

    

<p>インフラ力が上がると噂の競技ISUCONについて、ISUCON4優勝者自ら必勝法を公開。<br />
そのうちスライドも公開して頂けるらしいが自分のために。</p>

<p>リンク</p>

<ul>
<li><a href="http://isucon.net/">[公式]ISUCON</a></li>
<li><a href="http://yapcasia.org/2015/talk/show/86ebd212-fab3-11e4-8f5a-8ab37d574c3a">[公式]トーク情報</a></li>
<li><a href="http://togetter.com/li/863801">togetter</a></li>
</ul>

<p>スピーカー: @kazeburo さん</p>

<h2 id="時間配分:4cfb701cf836bbc5c7516541bfb56f95">時間配分</h2>

<ul>
<li>競技全体では7時間</li>
<li>最初の1時間

<ul>
<li>まだ慌てるような時間じゃない</li>
<li>課題の理解、プロファイリング・チューニングの方向性を決める</li>
</ul></li>
<li>最後の30分

<ul>
<li>再起動テストだけに使う</li>
<li>再起動の失敗はよくある</li>
</ul></li>
<li>上記を考慮すると、実際の作業時間は5時間ほど</li>
</ul>

<h2 id="事前準備:4cfb701cf836bbc5c7516541bfb56f95">事前準備</h2>

<ul>
<li>chatroom</li>
<li>(private) git repository

<ul>
<li>当日作業のリビジョン管理</li>
<li>見えてもいいならpublic</li>
</ul></li>
<li>wiki

<ul>
<li>すぐにペッと貼れて使える<code>my.cnf</code>などの設定ファイルを書いておく</li>
<li><code>sysctl</code>の設定方法などもググらなくて済むように書いておく</li>
</ul></li>
<li>技術選択

<ul>
<li>言語は何つかおうとか</li>
</ul></li>
<li>過去問

<ul>
<li>過去問大事</li>
<li><a href="http://isucon.net/archives/40724693.html">ISUCON4 予選問題の解説と講評 ＆ AMIの公開</a></li>
<li><a href="http://d.hatena.ne.jp/tmatsuu/20150815/1439643715">ISUCON予選突破の鍵は過去問を解くことなので無料で試せるようにした(Vagrant+Ansible)</a></li>
<li>EC2だとお金かかるけど、1日数百円程度なのでYouやっちゃいなよ！みたいな感じ</li>
</ul></li>
</ul>

<h2 id="チューニングの進め方:4cfb701cf836bbc5c7516541bfb56f95">チューニングの進め方</h2>

<h3 id="1-課題の理解:4cfb701cf836bbc5c7516541bfb56f95">1. 課題の理解</h3>

<ul>
<li>レギュレーションや説明をよく読む

<ul>
<li>スコアの算出方法、失格条件は特に注意</li>
</ul></li>
<li>実際に動いているアプリケーションを見てみる</li>
<li>とりあえずベンチ動かす

<ul>
<li>チューニングしていなくてもベンチ取る</li>
<li>ちゃんと動いているかを確認する</li>
</ul></li>
</ul>

<h3 id="2-プロファイリング:4cfb701cf836bbc5c7516541bfb56f95">2. プロファイリング</h3>

<ul>
<li>ログ解析や負荷確認</li>
<li>ベンチツールの挙動を把握する

<ul>
<li>アクセス頻度の高い所を優先的にチューニングする</li>
<li>重いけどスコアに関係ない部分は無視できるかも</li>
<li><a href="https://github.com/tagomoris/Apache-Log-Parser/blob/master/bin/analyze_apache_logs">analyze_apache_logs</a>や<a href="https://github.com/matsuu/kataribe">kataribe</a>を利用する</li>
</ul></li>
<li>mysql slow log解析

<ul>
<li>クエリの実行回数と頻度を見る</li>
<li><a href="https://www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html">pt-query-digest</a>を使う</li>
</ul></li>
<li>アプリケーションのプロファイリング

<ul>
<li>straceでシステムコールレベルの解析</li>
<li>tcpdumpで通信の解析</li>
</ul></li>
<li>サーバの負荷

<ul>
<li>top, iftop, iotop, dstat, &hellip;</li>
</ul></li>
</ul>

<h3 id="3-サーバ構成の把握:4cfb701cf836bbc5c7516541bfb56f95">3. サーバ構成の把握</h3>

<ul>
<li>どんなミドルウェアがいるのか</li>
<li>どのポートが使われているのか</li>
</ul>

<h3 id="4-チューニングの方向性を決める:4cfb701cf836bbc5c7516541bfb56f95">4. チューニングの方向性を決める</h3>

<ul>
<li>CPUの気持ちになり、コンテキストスイッチを減らす

<ul>
<li>不要な参照・通信・プロセスをとにかく減らす</li>
</ul></li>
</ul>

<h2 id="チューニングのヒント:4cfb701cf836bbc5c7516541bfb56f95">チューニングのヒント</h2>

<ul>
<li>重い処理を把握し、減らせないか考える

<ul>
<li>外部プロセス</li>
<li>HTML Templateレンダリング</li>
<li>Text, Image変換処理</li>
<li>DB, Cacheへの接続</li>
</ul></li>
<li>B-Treeを意識しながらDBのチューニングをする

<ul>
<li>Primary keyとSecondary keyの挙動を把握しておく</li>
</ul></li>
<li>不要なデータのioを最小限にする

<ul>
<li>すぐに捨てるようなデータはなるべく読み込まない</li>
<li><a href="http://www.slideshare.net/kazeburo/isucon-summerclass2014action2final">ISUCONで学ぶ Webアプリケーションのパフォーマンス向上のコツ 実践編 完全版</a>のP49あたりの話</li>
</ul></li>
</ul>


    <hr/>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
         
        var disqus_shortname = 'kobtea';

         
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

<nav class="container-fluid">
    <ul class="pager">
        
        <li class="previous"><a href="http://kobtea.net/posts/2015/08/23/yapc/"><i class="fa fa-caret-left"></i> YAPC::Asia Tokyo 2015 で聴いたセッションのメモや感想</a></li>
        

        
        <li class="next"><a href="http://kobtea.net/posts/2015/05/18/scala-future-recover/">[Scala] Future#recoverを使って例外処理する <i class="fa fa-caret-right"></i></a></li>
        
    </ul>
</nav>


<footer>
    <div class="container-fluid">
        <div class="row">

            <div class="col-md-4">
                <strong>Author</strong>
                <div class="media">
                    <div class="media-left media-top">
                        <img src="http://www.gravatar.com/avatar/0341c09395fd77b2a42ee5f8f681c24d.png">
                    </div>
                    <div class="media-body">
                        <strong class="media-heading">kobtea</strong>
                        <a href="https://twitter.com/kobtea"><i class="fa fa-twitter-square fa-lg"></i></a>
                        <a href="https://github.com/kobtea"><i class="fa fa-github-square fa-lg"></i></a>
                        <br/>
                        <small>カピバラと暮らしたい</small>
                    </div>
                </div>
            </div>

            

            <div class="col-md-8">
                <strong> Tags </strong><br/><br/>
                
                <a href="/tags/conference"><button type="button" class="btn btn-default btn-xs">conference</button></a>
                
                <a href="/tags/github-pages"><button type="button" class="btn btn-default btn-xs">github-pages</button></a>
                
                <a href="/tags/hardware"><button type="button" class="btn btn-default btn-xs">hardware</button></a>
                
                <a href="/tags/java"><button type="button" class="btn btn-default btn-xs">java</button></a>
                
                <a href="/tags/markdown"><button type="button" class="btn btn-default btn-xs">markdown</button></a>
                
                <a href="/tags/misc"><button type="button" class="btn btn-default btn-xs">misc</button></a>
                
                <a href="/tags/octopress"><button type="button" class="btn btn-default btn-xs">octopress</button></a>
                
                <a href="/tags/python"><button type="button" class="btn btn-default btn-xs">python</button></a>
                
                <a href="/tags/ruby"><button type="button" class="btn btn-default btn-xs">ruby</button></a>
                
                <a href="/tags/scala"><button type="button" class="btn btn-default btn-xs">scala</button></a>
                
                <a href="/tags/vim"><button type="button" class="btn btn-default btn-xs">vim</button></a>
                
                <a href="/tags/windows"><button type="button" class="btn btn-default btn-xs">windows</button></a>
                
            </div>

        </div>
        <p>&copy; 2015 kobtea | Powered by <a href="http://gohugo.io/">HUGO</a> | Themed with <a
                href="https://github.com/kobtea/hugo-theme-capybara">Capybara</a></p>
    </div>
</footer>
<script src="http://kobtea.net/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60750954-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
